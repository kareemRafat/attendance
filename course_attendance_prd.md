# PRD - نظام إدارة حضور طلاب كورسات البرمجة

## 1. مقدمة المشروع

**اسم المشروع:** نظام إدارة حضور طلاب كورسات البرمجة  
**الهدف:** تسهيل تسجيل حضور الطلاب ومتابعة الحضور والغياب والاستئذان، مع إمكانية إدارة الجروبات، نقل الطلاب بين الجروبات، وعرض تقارير دقيقة لكل طالب، لكل جروب، ولكل فرع.
**الفئة المستهدفة:** موظفي المركز (تسجيل حضور)، مدير/أدمن (إدارة الجروبات والموظفين ومتابعة الأداء)

## 2. المستخدمون والصلاحيات

| نوع المستخدم | الصلاحيات                                                                                |
| ------------ | ---------------------------------------------------------------------------------------- |
| Admin        | إدارة الموظفين، إضافة الفروع، إنشاء الجروبات، إنهاء الجروبات، متابعة كل الفروع والجروبات |
| Employee     | تسجيل حضور الطلاب في فرعه فقط، نقل الطلاب من جروب لآخر، عرض تقارير الطلاب في الفرع       |
| Student      | عرض بياناته فقط (اختياري لاحقًا)                                                         |

## 3. الصفحات الرئيسية والوظائف

### 3.1 صفحة الفروع والجروبات

- إضافة/تعديل فرع جديد
- إنشاء جروب جديد مرتبط بالفرع
- تحديد نوع الكورس: Frontend / Backend / Fullstack
- تحديد نمط الأيام: السبت+الثلاثاء، الأحد+الأربعاء، الاثنين+الخميس
- عرض عدد المحاضرات المنفذة وعدد المحاضرات المتبقية
- إنهاء الجروب يدويًا عند انتهاء جميع المحاضرات

### 3.2 صفحة إدارة الطلاب

- إضافة طالب جديد بدون رقم هاتف
- تعديل بيانات الطالب
- تسجيل الطالب في جروب محدد (Enrollment)
- نقل الطالب بين الجروبات بدءًا من المحاضرة القادمة
- عرض تاريخ انتقال الطالب بين الجروبات
- عرض تقارير الحضور، الغياب، الاستئذان لكل طالب

### 3.3 صفحة تسجيل الحضور (Attendance Page)

- اختيار الفرع (تلقائي للموظف)
- اختيار جروب اليوم الحالي فقط (system calculates based on pattern)
- عرض الطلاب النشطين في الجروب (Enrollment)
- تسجيل حالة كل طالب: حضور، استأذن، غياب تلقائي
- عرض العدادات live: الحضور، الاستئذان، الغياب
- حفظ جميع الحضور مرة واحدة (Bulk insert)
- إنشاء Lecture Session تلقائي عند أول حفظ فقط
- منع تسجيل الحضور لجروبات غير نشطة أو مكتملة
- دعم Keyboard Shortcuts للسرعة (اختياري)

### 3.4 صفحة إدارة الموظفين

- إضافة موظف جديد مع الفرع والدور
- تعديل بيانات الموظف
- عرض الموظفين لكل فرع أو لجميع الفروع (Admin فقط)
- التحكم في صلاحيات الموظف
- الموظف يرى جروبات فرعه فقط

### 3.5 صفحة التقارير (Student Report)

- البحث عن طالب محدد
- عرض الجروب الحالي، المحاضرات التي حضرها/استأذن/غاب فيها
- عدد مرات الحضور/الاستئذان/الغياب
- تاريخ النقل بين الجروبات
- نسبة الالتزام
- يعتمد على Attendance + Enrollment + Transfer Logs

## 4. قواعد العمل الأساسية

1. **Lecture Session Creation:** أول حفظ حضور فقط، مرتبط بـ group_id + date + lecture_number
2. **Attendance Recording:** Bulk insert، Default = absent، React State + TanStack Query
3. **Enrollment System:** الحضور القديم محفوظ، النقل يبدأ من المحاضرة القادمة
4. **Branch Isolation:** Global Scope + Middleware + Backend validation
5. **Group Completion:** يدوي، اقتراح عند 45 محاضرة، بعد الإنهاء يمنع تسجيل محاضرات جديدة
6. **Race Condition Protection:** DB Unique Constraint (group_id, date), Transaction + lock
7. **Performance:** React State، Bulk insert، TanStack Query لمutations فقط

## 5. التقنيات الموصى بها

| الطبقة           | التقنية                              |
| ---------------- | ------------------------------------ |
| Backend          | Laravel 12                           |
| Frontend         | React 19 + Inertia.js + shadcn/ui    |
| State Management | TanStack Query (للحضور فقط)          |
| DB               | MySQL / MariaDB                      |
| Authentication   | نظام الحضور للطلاب (Inertia + React) |

## 6. ملاحظات إضافية

- Audit Trail لكل عملية مهمة: نقل الطلاب، إنهاء الجروبات، تسجيل الحضور
- أي حذف أو تعديل محمي بـ role-based permission
- النظام قابل للتوسعة: إضافة فروع، كورسات، نمط أيام جديد
